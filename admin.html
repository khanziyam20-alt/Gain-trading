<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Gain Trading</title>
    <style>
        body { font-family: 'Inter', sans-serif; background: #0f172a; color: white; padding: 20px; }
        .container { max-width: 900px; margin: auto; }
        header { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #334155; padding-bottom: 10px; margin-bottom: 20px; }
        table { width: 100%; border-collapse: collapse; background: #1e293b; border-radius: 12px; overflow: hidden; }
        th, td { padding: 15px; text-align: left; border-bottom: 1px solid #334155; }
        th { background: #334155; color: #38bdf8; font-size: 0.9rem; text-transform: uppercase; }
        input[type="number"] { padding: 8px; border-radius: 6px; border: 1px solid #475569; background: #0f172a; color: white; width: 80px; outline: none; }
        .update-btn { background: #10b981; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        .update-btn:hover { background: #059669; transform: translateY(-1px); }
        .admin-badge { background: #38bdf8; color: #0f172a; padding: 4px 12px; border-radius: 20px; font-size: 0.8rem; font-weight: bold; }
    </style>
</head>
<body>

    <div class="container">
        <header>
            <h1>Admin Controller</h1>
            <span class="admin-badge">Management Mode</span>
        </header>

        <table>
            <thead>
                <tr>
                    <th>User Details</th>
                    <th>Wallet Balance</th>
                    <th>Profit Rate (%/Sec)</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody id="userList">
                </tbody>
        </table>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, collection, onSnapshot, doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyBMicn5UaGmlpyjqyvHndQAqpBTIl5KKTs",
  authDomain: "gain-trading.firebaseapp.com",
  databaseURL: "https://gain-trading-default-rtdb.firebaseio.com",
  projectId: "gain-trading",
  storageBucket: "gain-trading.firebasestorage.app",
  messagingSenderId: "158325829948",
  appId: "1:158325829948:web:004921f55b11297c596e39",
  measurementId: "G-NS2Q5NEMMC"
};

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Updated Admin Email
        const ADMIN_EMAIL = "khanziyam20@gmail.com"; 

        onAuthStateChanged(auth, (user) => {
            if (!user || user.email.toLowerCase() !== ADMIN_EMAIL.toLowerCase()) {
                alert("Access Denied! You are not an administrator.");
                window.location.href = "index.html";
            } else {
                loadUsers();
            }
        });

        function loadUsers() {
            onSnapshot(collection(db, "users"), (snapshot) => {
                const userList = document.getElementById('userList');
                userList.innerHTML = "";

                snapshot.forEach((userDoc) => {
                    const data = userDoc.data();
                    const id = userDoc.id;

                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>
                            <strong>${data.name}</strong><br>
                            <small style="color:#94a3b8">${data.email}</small>
                        </td>
                        <td>$${(data.walletBalance || 0).toFixed(2)}</td>
                        <td>
                            <input type="number" id="rate-${id}" value="${data.profitRate || 0}" step="0.01">
                        </td>
                        <td>
                            <button class="update-btn" onclick="saveRate('${id}')">Update</button>
                        </td>
                    `;
                    userList.appendChild(tr);
                });
            });
        }

        window.saveRate = async (userId) => {
            const newRate = parseFloat(document.getElementById(`rate-${userId}`).value);
            try {
                await updateDoc(doc(db, "users", userId), {
                    profitRate: newRate
                });
                alert("Profit rate updated successfully!");
            } catch (e) {
                alert("Update failed: " + e.message);
            }
        };
    </script>
</body>
</html>
